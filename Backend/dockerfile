# Utiliser une image Node.js 20 basée sur Debian (plus compatible avec les dépendances natives)
FROM node:20-buster

# Installer les dépendances nécessaires pour la compilation des modules natifs comme bcrypt
RUN apt-get update && apt-get install -y \
    python3 \
    make \
    g++ \
    libpixman-1-dev \
    libcairo2-dev \
    libpango1.0-dev \
    libjpeg-dev \
    libgif-dev \
    && rm -rf /var/lib/apt/lists/*

# Définir le répertoire de travail
WORKDIR /app

# Copier les fichiers de package.json pour une meilleure mise en cache des couches
COPY package*.json ./

# Installation des dépendances (forcera la recompilation des modules natifs comme bcrypt)
RUN npm install --build-from-source

# Copier tous les fichiers de l'application
COPY . .

# Exposer le port sur lequel ton app écoute
EXPOSE 8070

# Lancer l'application
CMD ["node", "server.js"]
